<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/content-details.css" />
    <title><%= content.name %> - Netflix</title>
    <script src="/js/api.js" defer></script>
    <script src="/js/content-details.js" defer></script>
    <% if (content.type === 'show' && content.seasons) { %>
    <script>
      // Pass seasons data to JavaScript
        window.seasonsData = <%- JSON.stringify(content.seasons) %>;
    </script>
    <% } %>
  </head>
  <body data-profile-id="<%= profileId %>" data-user-id="<%= userId %>" data-content-id="<%= content.id %>" data-content-type="<%= content.type %>" data-genre="<%= content.genre && content.genre.length > 0 ? content.genre[0] : '' %>" data-is-liked="<%= isLiked ? 'true' : 'false' %>">
    <!-- Header (same as feed page) -->
    <div class="feed-header">
      <div class="netflix-logo">
        <img src="/resources/netflix_logo.png" alt="Netflix Logo" width="100" />
      </div>
      <div class="nav-selection-container">
        <button class="hamburger-btn">‚ò∞</button>
        <div class="nav-menu">
          <a class="nav-selection" href="#">Home</a>
          <a class="nav-selection" href="#">TV Shows</a>
          <a class="nav-selection" href="#">Movies</a>
          <a class="nav-selection" href="#">New & Popular</a>
          <a class="nav-selection" href="#">My List</a>
          <a class="nav-selection" href="#">Browse by Languages</a>
        </div>
      </div>
      <div class="settings-container">
        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="Search for a title..."
          />
          <button class="sort-button">A-Z</button>
          <img
            src="/resources/search_icon.png"
            alt="Search Icon"
            width="25"
            class="search-icon"
            style="cursor: pointer"
          />
        </div>
        <a href="/logout">
          <img
            src="/resources/logout.png"
            alt="Logout Icon"
            width="25"
            class="icon"
          />
        </a>
        <a href="/profiles?userId=<%= userId %>">
          <div class="profile-avatar-container" id="profile-avatar-container">
            <div class="profile-loading"></div>
          </div>
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="content-details-page">
      <!-- Back Button -->
      <div class="back-button-container">
        <button class="back-button" onclick="window.location.href='/feed?userId=<%= userId %>&profileId=<%= profileId %>'">‚Üê Back to Feed</button>
      </div>

      <!-- Content Image and Info Container -->
      <div class="content-main-container">
        <!-- Content Image (only show if thumbnail exists) -->
        <% if (content.thumbnail) { %>
        <div class="content-image-container">
          <img src="<%= content.thumbnail %>" alt="<%= content.name %>" class="content-image" />
        </div>
        <% } %>

        <!-- Content Info and Buttons -->
        <div class="content-info-container">
          <h1 class="content-title"><%= content.name %></h1>
          <div class="content-metadata">
            <span class="content-year"><%= content.year %></span>
            <span class="content-type"><%= content.type %></span>
            <% if (content.rating) { %>
            <span class="content-rating"><%= content.rating %></span>
            <% } %>
          </div>

          <!-- Genres -->
          <div class="content-genres">
            <% content.genre.forEach(function(genre) { %>
            <span class="genre-tag"><%= genre %></span>
            <% }); %>
          </div>

          <!-- Description -->
          <% if (content.summary) { %>
          <p class="content-description"><%= content.summary %></p>
          <% } %>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button class="play-button" id="play-button">
              ‚ñ∂ Play
            </button>
            <button class="like-button" id="like-button">
              <span class="like-icon">üëç</span> Like
            </button>
          </div>
        </div>
      </div>

    <!-- Cast Section -->
    <% if (content.cast && content.cast.length> 0) { %>
        <div class="cast-container">
            <h2 class="cast-title">Cast</h2>
            <div class="cast-grid">
                <% content.cast.forEach(function(actor) { %>
                    <div class="cast-member">
                        <% if (actor.wikiUrl && actor.wikiUrl !=='' ) { %>
                            <a href="<%= actor.wikiUrl %>" target="_blank" class="cast-link">
                                <div class="cast-name">
                                    <%= actor.name %>
                                </div>
                            </a>
                            <% } else { %>
                                <div class="cast-name">
                                    <%= actor.name %>
                                </div>
                                <% } %>
                    </div>
                    <% }); %>
            </div>
        </div>
        <% } %>

      <!-- Episodes Section (only for TV shows) -->
      <% if (content.type === 'show' && content.seasons && content.seasons.length > 0) { %>
      <div class="episodes-container">
        <div class="episodes-header">
          <h2>Episodes</h2>
          <div class="season-selector">
            <label for="season-dropdown">Season:</label>
            <select id="season-dropdown" class="season-dropdown">
              <% content.seasons.forEach(function(season) { %>
              <option value="<%= season.seasonNumber %>">Season <%= season.seasonNumber %></option>
              <% }); %>
            </select>
          </div>
        </div>

        <!-- Episodes List -->
        <div class="episodes-list" id="episodes-list">
          <!-- Episodes will be loaded here dynamically -->
        </div>
      </div>
      <% } %>

      <!-- Recommended Content Section -->
      <div class="recommended-container">
        <h2 class="recommended-title">More Like This</h2>
        <div class="recommended-content-grid" id="recommended-content-grid">
          <!-- Recommended content will be loaded here dynamically -->
        </div>
      </div>
    </div>
  </body>
</html>
